<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #f8f9fa;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        p {
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            max-width: 800px;
            margin: 30px 0;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stats-container {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .stat-card {
            padding: 20px;
            border-radius: 8px;
            flex: 1;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .todo-card {
            background: #ffeaa7;
            border-left: 5px solid #fdcb6e;
        }

        .progress-card {
            background: #dfe6e9;
            border-left: 5px solid #636e72;
        }

        .done-card {
            background: #55efc4;
            border-left: 5px solid #00b894;
        }

        .api-links {
            margin-top: 40px;
            padding: 25px;
            background-color: #2c3e50;
            border-radius: 8px;
            color: white;
        }

        .api-links h3 {
            margin-top: 0;
            color: #ecf0f1;
        }

        .api-links ul {
            list-style-type: none;
            padding-left: 0;
        }

        .api-links li {
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            transition: background 0.3s;
        }

        .api-links li:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .api-links a {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
            display: block;
        }

        .api-links a:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        hr {
            border: none;
            height: 1px;
            background: #ddd;
            margin: 40px 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .chart-container {
                height: 300px;
                padding: 10px;
            }

            .stats-container {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <h1>üìä Task Dashboard</h1>
    <p>Simple reporting feature using live database data</p>

    <!-- Stats Cards -->
    <div class="stats-container">
        <div class="stat-card todo-card">
            <h2>To Do</h2>
            <div class="stat-number" id="todoCount">{{ todo }}</div>
        </div>
        <div class="stat-card progress-card">
            <h2>In Progress</h2>
            <div class="stat-number" id="inProgressCount">{{ in_progress }}</div>
        </div>
        <div class="stat-card done-card">
            <h2>Done</h2>
            <div class="stat-number" id="doneCount">{{ done }}</div>
        </div>
    </div>

    <!-- Chart Container -->
    <div class="chart-container">
        <canvas id="taskChart"></canvas>
    </div>

    <hr>

    <!-- API Links -->
    <div class="api-links">
        <h3>API Endpoints:</h3>
        <ul>
            <li><a href="/api/tasks/" target="_blank">GET /api/tasks/</a> - Retrieve all tasks</li>
            <li><a href="/api/exchange-rate/" target="_blank">GET /api/exchange-rate/</a> - Get current exchange rates
            </li>
        </ul>
    </div>

    <script>
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function () {
            // Parse the template variables safely
            // Using parseInt to ensure we get numbers, with fallback to 0
            let todoValue = 0;
            let inProgressValue = 0;
            let doneValue = 0;

            try {
                // Try to get values from the stat cards (already rendered by template)
                const todoElement = document.getElementById('todoCount');
                const progressElement = document.getElementById('inProgressCount');
                const doneElement = document.getElementById('doneCount');

                if (todoElement) todoValue = parseInt(todoElement.textContent) || 0;
                if (progressElement) inProgressValue = parseInt(progressElement.textContent) || 0;
                if (doneElement) doneValue = parseInt(doneElement.textContent) || 0;

                console.log('Chart data loaded:', {
                    todo: todoValue,
                    inProgress: inProgressValue,
                    done: doneValue
                });

                // Initialize the chart
                initializeChart(todoValue, inProgressValue, doneValue);

            } catch (error) {
                console.error('Error loading chart data:', error);
                displayError();
            }
        });

        function initializeChart(todo, inProgress, done) {
            const ctx = document.getElementById('taskChart').getContext('2d');

            // Check if canvas context is available
            if (!ctx) {
                displayError();
                return;
            }

            // Create the chart
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['To Do', 'In Progress', 'Done'],
                    datasets: [{
                        label: 'Task Count',
                        data: [todo, inProgress, done],
                        backgroundColor: [
                            'rgba(253, 203, 110, 0.8)',
                            'rgba(99, 110, 114, 0.8)',
                            'rgba(0, 184, 148, 0.8)'
                        ],
                        borderColor: [
                            'rgb(253, 203, 110)',
                            'rgb(99, 110, 114)',
                            'rgb(0, 184, 148)'
                        ],
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Task Status Distribution',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 30
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            padding: 12,
                            cornerRadius: 6
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                font: {
                                    size: 14
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        function displayError() {
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                chartContainer.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #e74c3c;">
                        <h3>‚ö†Ô∏è Chart Error</h3>
                        <p>Unable to load chart data. Please check if the server is running and try again.</p>
                        <p><small>You can still use the API links below.</small></p>
                    </div>
                `;
            }
        }
    </script>
</body>

</html>